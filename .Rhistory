library(readr)
campaigns <- read_csv("data/schema/campaigns.csv")
View(campaigns)
knitr::opts_chunk$set(echo = TRUE)
getwd()
campaigns <- read.csv("data/schema/campaigns.csv",
stringsAsFactors = FALSE)
str(campaigns)
campaigns <- read.csv("data/schema/campaigns.csv",
stringsAsFactors = FALSE)
str(campaigns)
# Reload raw version
campaigns <- read.csv("data/schema/campaigns.csv", stringsAsFactors = FALSE)
# ---- CLEAN COLUMN NAMES ----
names(campaigns) <- names(campaigns) |>
tolower() |>
gsub(" ", "_", .)
# Reload raw version
campaigns <- read.csv("data/schema/campaigns.csv", stringsAsFactors = FALSE)
knitr::opts_chunk$set(echo = TRUE)
campaigns <- read.csv("data/schema/campaigns.csv",
stringsAsFactors = FALSE)
str(campaigns)
# Reload raw version
campaigns <- read.csv("data/schema/campaigns.csv", stringsAsFactors = FALSE)
# Reload raw version
campaigns <- read.csv("data/schema/campaigns.csv", stringsAsFactors = FALSE)
## Convert start_date and end_date from character → datetime
campaigns$start_date <- as.POSIXct(campaigns$start_date, tz = "UTC")
campaigns$end_date   <- as.POSIXct(campaigns$end_date,   tz = "UTC")
# Make sure spend_amount is numeric (it already is, but we can be explicit)
campaigns$spend_amount <- as.numeric(campaigns$spend_amount)
# Make sure flags are integer
campaigns$is_active <- as.integer(campaigns$is_active)
# Check structure again
str(campaigns)
write.csv(campaigns,
"data/schema/campaigns.csv",
row.names = FALSE)
organizations <- read.csv("data/schema/organizations.csv",
stringsAsFactors = FALSE)
str(organizations)
# Reload (just to be consistent)
organizations <- read.csv("data/schema/organizations.csv",
stringsAsFactors = FALSE)
# Convert created_date from chr → datetime
organizations$created_date <- as.POSIXct(organizations$created_date,
tz = "UTC")
# Check structure again
str(organizations)
organizations <- read.csv("data/schema/organizations.csv",
stringsAsFactors = FALSE)
str(organizations)
# Reload (just to be consistent)
organizations <- read.csv("data/schema/organizations.csv",
stringsAsFactors = FALSE)
# Convert created_date from chr → datetime
organizations$created_date <- as.POSIXct(organizations$created_date,
tz = "UTC")
# Check structure again
str(organizations)
write.csv(organizations,
"data/schema/organizations.csv",
row.names = FALSE)
members <- read.csv("data/schema/members.csv",
stringsAsFactors = FALSE)
str(members)
# Reload to be explicit
members <- read.csv("data/schema/members.csv",
stringsAsFactors = FALSE)
# Convert join_date and renewal_date from chr → datetime
members$join_date    <- as.POSIXct(members$join_date,    tz = "UTC")
members$renewal_date <- as.POSIXct(members$renewal_date, tz = "UTC")
# Make sure is_active is integer (it already is, but this is explicit)
members$is_active <- as.integer(members$is_active)
# Check structure again
str(members)
leads <- read.csv("data/schema/leads.csv",
stringsAsFactors = FALSE)
str(leads)
# ---- BASE INTS ----
leads$lead_id     <- as.integer(leads$lead_id)
leads$org_id      <- as.integer(leads$org_id)
leads$campaign_id <- as.integer(leads$campaign_id)
# ---- LEAD CREATED DATE (chr -> datetime) ----
leads$lead_created_date <- as.POSIXct(leads$lead_created_date,
tz = "UTC")
# ---- LEAD CREATED DATE (chr -> datetime) ----
leads$lead_created_date <- as.POSIXct(leads$lead_created_date,
tz = "UTC")
# ---- CONVERTED FLAG (0/1) ----
leads$converted_flag <- as.integer(leads$converted_flag)
# ---- CONVERTED MEMBER ID (num with .0 -> int) ----
# Example: 14147.0 -> 14147, NAs stay NA
leads$converted_member_id <- as.integer(leads$converted_member_id)
# ---- CONVERSION DATE (nanoseconds since 1970 -> datetime) ----
# Values look like 1.7e+18, which = seconds * 1e9
# So we divide by 1e9 to get seconds, then POSIXct
leads$conversion_date <- as.POSIXct(leads$conversion_date / 1e9,
origin = "1970-01-01",
tz = "UTC")
# ---- CHECK RESULT ----
str(leads)
campaign_touches <- read.csv("data/schema/campaign_touches.csv",
stringsAsFactors = FALSE)
campaign_touches <- read.csv("data/schema/campaign_touches.csv",
stringsAsFactors = FALSE)
str(campaign_touches)
# Reload to be explicit
campaign_touches <- read.csv("data/schema/campaign_touches.csv",
stringsAsFactors = FALSE)
# Reload to be explicit
campaign_touches <- read.csv("data/schema/campaign_touches.csv",
stringsAsFactors = FALSE)
# Convert timestamp from chr -> datetime
campaign_touches$touch_timestamp <- as.POSIXct(
campaign_touches$touch_timestamp,
tz = "UTC"
)
# (Optional but explicit)
campaign_touches$touch_id    <- as.integer(campaign_touches$touch_id)
# (Optional but explicit)
campaign_touches$touch_id    <- as.integer(campaign_touches$touch_id)
campaign_touches$lead_id     <- as.integer(campaign_touches$lead_id)
campaign_touches$campaign_id <- as.integer(campaign_touches$campaign_id)
campaign_touches$campaign_id <- as.integer(campaign_touches$campaign_id)
# Check structure
str(campaign_touches)
engagement_events <- read.csv("data/schema/engagement_events.csv",
stringsAsFactors = FALSE)
str(engagement_events)
# Reload to be explicit
engagement_events <- read.csv("data/schema/engagement_events.csv",
stringsAsFactors = FALSE)
# Reload to be explicit
engagement_events <- read.csv("data/schema/engagement_events.csv",
stringsAsFactors = FALSE)
# Convert timestamp from chr -> datetime
engagement_events$event_timestamp <- as.POSIXct(
engagement_events$event_timestamp,
tz = "UTC"
)
# Convert timestamp from chr -> datetime
engagement_events$event_timestamp <- as.POSIXct(
engagement_events$event_timestamp,
tz = "UTC"
)
# (Optional but explicit)
engagement_events$event_id  <- as.integer(engagement_events$event_id)
engagement_events$member_id <- as.integer(engagement_events$member_id)
engagement_events$member_id <- as.integer(engagement_events$member_id)
# Check structure
str(engagement_events)
product_sales <- read.csv("data/schema/product_sales.csv",
stringsAsFactors = FALSE)
str(product_sales)
# Reload to be explicit
product_sales <- read.csv("data/schema/product_sales.csv",
stringsAsFactors = FALSE)
# Convert purchase_timestamp to datetime
product_sales$purchase_timestamp <- as.POSIXct(
product_sales$purchase_timestamp,
tz = "UTC"
)
# Be explicit about numeric/int types
product_sales$order_id   <- as.integer(product_sales$order_id)
product_sales$member_id  <- as.integer(product_sales$member_id)
product_sales$product_id <- as.integer(product_sales$product_id)
product_sales$price_usd  <- as.numeric(product_sales$price_usd)
# Check result
str(product_sales)
# =============================================================
# SAVE ALL CLEANED TABLES TO /data/schema/
# =============================================================
write.csv(campaigns,
"data/schema/campaigns.csv",
row.names = FALSE)
write.csv(organizations,
"data/schema/organizations.csv",
row.names = FALSE)
write.csv(members,
"data/schema/members.csv",
row.names = FALSE)
write.csv(leads,
"data/schema/leads.csv",
row.names = FALSE)
write.csv(campaign_touches,
"data/schema/campaign_touches.csv",
row.names = FALSE)
write.csv(engagement_events,
"data/schema/engagement_events.csv",
row.names = FALSE)
write.csv(product_sales,
"data/schema/product_sales.csv",
row.names = FALSE)
# =============================================================
# Confirm by printing messages
# =============================================================
cat("All 7 cleaned CSVs have been saved successfully.\n")
